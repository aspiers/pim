#!/usr/bin/env zsh

# Does org-mobile-push from ~/org/mobile via tramp+scp to the remote
# directory.
#
# For org-mobile-pull, emacs reads from and writes to the remote
# mobileorg.org inbox directly via tramp so no rsync is required.
# Any new items captured via the Android app will then appear locally
# in the file defined by `org-mobile-inbox-for-pull'

dsa

div

if isup indian; then
    echo "Pulling latest ~/SUSE ..."
    (cd ~/SUSE; git pull 2>&1)

    div
fi

echo -e "org-mobile-push ...\n"

org_mobile_dir=$HOME/org/mobile

unset COLUMNS
export QUICK_EMACS=1
lisp="
    (let ((tramp-verbose 7)
          (debug-on-error t)
          (org-agenda-sticky nil) ;; seems to be a bug
          (org-mobile-files '(\"$org_mobile_dir\"))
          ;; Uncomment this for a quick test run
          ;; (org-mobile-agendas 'default)
         )
      (require 'org-mobile nil 'noerror)
      ;;(message \"omd is %s\" org-mobile-directory)
      (org-mobile-push))"
nice -n19 emacs --batch --load ~/.emacs --eval "$lisp"
result=$?

if [ $result != 0 ]; then
    echo "emacs org-mobile-push failed." >&2
fi

exit $result
