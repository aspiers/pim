#!/usr/bin/env zsh

dest_root=adamspiers.org:web/adamspiers.org/html/org
#dest_secure=$dest_root/b682b0d5-1598943d1120
dest_dav=$dest_root/dav

dsa

div

# echo SUSE
# [ -d ~/folder ] && rsync -avz ~/SUSE/*.{ics,org} $dest_secure/SUSE
#
# div
#
# echo org
# rsync -avz ~/org/{*.{ics,org},notes/Packing.org,TODO.html} $dest_secure/org
#
# div

echo -e "org-mobile-push ...\n"

if ! tmpdir=`mktemp --tmpdir -d sync-org.XXXXXXXXXXX`; then
    echo "Failed to create temporary directory" >&2
    exit 1
fi

cd "$tmpdir"
cp ~/org/TODO.org .
# Need to rename SUSE TODO to avoid clash with personal TODO
cp ~/SUSE/TODO.org SUSE-TODO.org

unset COLUMNS
export QUICK_EMACS=1
lisp="
    (let ((org-mobile-files '(\"$tmpdir\"))
          ;; Uncomment this for a quick test run
          ;; (org-mobile-agendas 'default)
         )
      (org-mobile-push))"
emacs --batch --load ~/.emacs --eval "$lisp"

rm -rf "$tmpdir"

#div

# because tramp is too fucking incompetent to scp in behalf of org-mobile-push
#rsync -avz --exclude=mobileorg.org ~/org/org-mobile/ $dest_dav
